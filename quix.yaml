# Quix Project Descriptor
# This file describes the data pipeline and configuration of resources of a Quix Project.

metadata:
  version: 1.0

# This section describes the Deployments of the data pipeline
deployments:
  - name: MQTT Source
    application: mqtt-source
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 200
      replicas: 1
    variables:
      - name: output
        inputType: OutputTopic
        description: Name of the output topic to publish to.
        required: true
        value: mqtt-raw
      - name: mqtt_topic
        inputType: FreeText
        description: The root for messages in MQTT, this can be anything
        required: true
        value: '#'
      - name: mqtt_server
        inputType: FreeText
        description: The address of your MQTT server
        required: true
        value: c1f91eda588740f5a81e4ed3fd9c86d1.s1.eu.hivemq.cloud
      - name: mqtt_port
        inputType: FreeText
        description: The port of your MQTT server
        required: true
        value: 8883
      - name: mqtt_username
        inputType: FreeText
        description: Username of your MQTT user
        value: admin
      - name: mqtt_password
        inputType: Secret
        description: Password for the MQTT user
        secretKey: mqtt_password
      - name: mqtt_version
        inputType: FreeText
        description: 'MQTT protocol version: 3.1, 3.1.1, 5'
        required: true
        value: 3.1.1
  - name: Data normalisation
    application: data-normalisation
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    state:
      enabled: true
      size: 1
    variables:
      - name: input
        inputType: InputTopic
        description: Name of the input topic to listen to.
        value: mqtt-raw
      - name: output
        inputType: OutputTopic
        description: Name of the output topic to write to.
        value: sensor-data
  - name: Data transposition
    application: data-transposition
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    state:
      enabled: true
      size: 1
    variables:
      - name: input
        inputType: InputTopic
        description: Name of the input topic to listen to.
        value: sensor-data
      - name: output
        inputType: OutputTopic
        description: Name of the output topic to write to.
        value: sensor-table
  - name: QuixLake SensorData Sink
    application: quixlake-s3-sink
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    variables:
      - name: input
        inputType: InputTopic
        description: Name of the Kafka input topic to consume from
        required: true
        value: sensor-data
      - name: S3_BUCKET
        inputType: FreeText
        description: S3 bucket name for storing Parquet files
        required: true
        value: quix-test-bucket
      - name: S3_PREFIX
        inputType: FreeText
        description: S3 prefix/path for data files
        value: iceberg
      - name: TABLE_NAME
        inputType: FreeText
        description: Table name for data organization and registration
        value: sensordata
      - name: HIVE_COLUMNS
        inputType: FreeText
        description: Comma-separated list of columns for Hive partitioning (e.g., location,sensor_type)
        value: machine,sensor_id
      - name: TIMESTAMP_COLUMN
        inputType: FreeText
        description: Column containing timestamp values for time-based partitioning
        value: ts_ms
      - name: TIMESTAMP_FORMAT
        inputType: FreeText
        description: Time partition granularity
        value: day
      - name: CATALOG_URL
        inputType: FreeText
        description: REST Catalog URL for optional table registration (leave empty to skip)
        value: https://iceberg-catalog-peter-quixlake-webinar.app-staging.quix.io
      - name: AUTO_DISCOVER
        inputType: FreeText
        description: Automatically register table in REST Catalog on first write
        value: true
      - name: BATCH_SIZE
        inputType: FreeText
        description: Number of messages to batch before writing to S3
        value: 10000
      - name: COMMIT_INTERVAL
        inputType: FreeText
        description: Kafka commit interval in seconds
        value: 30
      - name: CONSUMER_GROUP
        inputType: FreeText
        description: Kafka consumer group name
        value: s3_direct_sink_v1.1
      - name: AUTO_OFFSET_RESET
        inputType: FreeText
        description: Where to start consuming if no offset exists
        value: latest
      - name: AWS_ACCESS_KEY_ID
        inputType: Secret
        description: AWS Access Key ID for S3 access
        secretKey: AWS_ACCESS_KEY_ID
      - name: AWS_SECRET_ACCESS_KEY
        inputType: Secret
        description: AWS Secret Access Key for S3 access
        secretKey: AWS_SECRET_ACCESS_KEY
      - name: AWS_REGION
        inputType: FreeText
        description: AWS region for S3 bucket
        value: eu-west-2
      - name: CATALOG_NAMESPACE
        inputType: FreeText
        description: Catalog namespace for table registration
        value: default
  - name: QuixLake SensorTable sink
    application: quixlake-s3-sink
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    variables:
      - name: input
        inputType: InputTopic
        description: Name of the Kafka input topic to consume from
        required: true
        value: sensor-table
      - name: S3_BUCKET
        inputType: FreeText
        description: S3 bucket name for storing Parquet files
        required: true
        value: quix-test-bucket
      - name: S3_PREFIX
        inputType: FreeText
        description: S3 prefix/path for data files
        value: iceberg
      - name: TABLE_NAME
        inputType: FreeText
        description: Table name for data organization and registration
        value: sensortable
      - name: HIVE_COLUMNS
        inputType: FreeText
        description: Comma-separated list of columns for Hive partitioning (e.g., location,sensor_type)
        value: machine
      - name: TIMESTAMP_COLUMN
        inputType: FreeText
        description: Column containing timestamp values for time-based partitioning
        value: ts_ms
      - name: TIMESTAMP_FORMAT
        inputType: FreeText
        description: Time partition granularity
        value: day
      - name: CATALOG_URL
        inputType: FreeText
        description: REST Catalog URL for optional table registration (leave empty to skip)
        value: https://iceberg-catalog-peter-quixlake-webinar.app-staging.quix.io
      - name: AUTO_DISCOVER
        inputType: FreeText
        description: Automatically register table in REST Catalog on first write
        value: true
      - name: BATCH_SIZE
        inputType: FreeText
        description: Number of messages to batch before writing to S3
        value: 10000
      - name: COMMIT_INTERVAL
        inputType: FreeText
        description: Kafka commit interval in seconds
        value: 30
      - name: CONSUMER_GROUP
        inputType: FreeText
        description: Kafka consumer group name
        value: s3_direct_sink_v1.0
      - name: AUTO_OFFSET_RESET
        inputType: FreeText
        description: Where to start consuming if no offset exists
        value: latest
      - name: AWS_ACCESS_KEY_ID
        inputType: Secret
        description: AWS Access Key ID for S3 access
        secretKey: AWS_ACCESS_KEY_ID
      - name: AWS_SECRET_ACCESS_KEY
        inputType: Secret
        description: AWS Secret Access Key for S3 access
        secretKey: AWS_SECRET_ACCESS_KEY
      - name: AWS_REGION
        inputType: FreeText
        description: AWS region for S3 bucket
        value: eu-west-2
      - name: CATALOG_NAMESPACE
        inputType: FreeText
        description: Catalog namespace for table registration
        value: default

# This section describes the Topics of the data pipeline
topics:
  - name: mqtt-raw
    dataTier: Bronze
  - name: sensor-table
    dataTier: Silver
  - name: sensor-data
    dataTier: Silver
